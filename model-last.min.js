(function(n,r){if("object"===typeof module&&"object"===typeof module.exports)module.exports=n.document?r(n,!0):function(n){return r(n)};else return r(n)})("undefined"!==typeof window?window:this,function(n,r){function E(a,b){if("string"==typeof a&&"string"==typeof b)return a.localeCompare(b);if("number"==typeof a&&"string"==typeof b)return-1;if("string"==typeof a&&"number"==typeof b)return 1;if("number"==typeof a&&"number"==typeof b){if(a>b)return 1;if(a==b)return 0;if(a<b)return-1}return 0}function u(a,
b,c,d){var f=q[0],e=v[0];Object.defineProperty(this,"boolean",{get:function(){return e},set:function(a){e=m.convert_boolean(a)}});Object.defineProperty(this,"operator",{get:function(){return f},set:function(a){f=m.convert_operator(a)}});this.field=a;this.value=c;this.boolean=d;this.operator=b}function w(a){var b=this,c,f=[];Object.defineProperty(this,"boolean",{get:function(){return c},set:function(a){c=m.convert_boolean(a)}});Object.defineProperty(this,"conditions",{get:function(){return f}});this.boolean=
a;this.where=function(a,b,c,g){if(d.isObject(a)){g=b;for(var e in a)this.where(e,q[0],a[e],g)}else d.isString(a)&&0<String(a).length?2==arguments.length?f.push(new u(a,q[0],b)):f.push(new u(a,b,c,g)):d.isFunction(a)&&(e=new w(b),a.call(e),f.push(e));return this};this.queryString=function(){var a=[];d.each(b.conditions,function(b,c){0<parseInt(b)&&a.push(-1!=d.inArray(c["boolean"],x,0)?" OR ":" AND ");c instanceof w?a.push("("+c.queryString()+")"):c instanceof u&&(b=c.field,String(c.value).replace(y,
z),a.push("`"+b+"`"),a.push(c.operator),a.push(d.isNumber(c.value)?c.value:"'"+("like"==c.operator?"%"+String(c.value)+"%":String(c.value))+"'"))});return a.join(" ")};var g=function(a,b){if(b instanceof w)return b.isMatch(a);if(b instanceof u){var c=b.field,f=b.value,e=!1;if(d.isDefined(a[c]))switch(b.operator){case "=":case "==":e=a[c]==f;break;case "===":e=a[c]===f;break;case "!=":e=a[c]!=f;break;case "<>":case "!==":e=a[c]!==f;break;case "<":case "<<":e=a[c]<f;break;case "<=":e=a[c]<=f;break;
case ">":case ">>":e=a[c]>f;break;case ">=":e=a[c]>=f;break;case "like":e=function(a,b){var c=!1;d.each(b,function(b,f){if(""!=f&&-1<String(a).indexOf(f))return c=!0,!1});return c}(a[c],String(f).replace(y,z).split("%"));break;default:e=!1}return e}return d.isBoolean(b)?b:!1};this.isMatch=function(a){var b=this.conditions;if(0==b.length)return!0;var c=!1;d.each(b,function(b,f){c=0<parseInt(b)?-1!=d.inArray(f["boolean"],x,0)?c||g(a,f):c&&g(a,f):g(a,f)});return c}}var A=!1,h={},B=null,k=[],q="== === < > <= >= <> != << >> like".split(" "),
v=["&&","||","|"],F={and:"&&",or:"||"},C=["left","right","inner"],x=["||","|","or"],G=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,y=/\\|'|\r|\n|\u2028|\u2029/g,t=function(){if(1==A){var a=["echo["+((new Date).getTime()-B)/1E3+"s]:"],b;for(b in arguments)a.push(arguments[b]);console.log.apply(this,a)}},H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},z=function(a){return"\\"+H[a]},D={get data(){return k},each:function(){d.each.apply(this,arguments)},sum:function(a,b){var c=0;this.each(b,
function(b,g){d.isDefined(g[a])&&(c+=parseFloat(g[a]))});return c}},d={inArray:function(a,b,c){var f;if(b){if([].indexOf)return Array.prototype.indexOf.call(b,a,c);f=b.length;for(c=c?0>c?Math.max(0,f+c):c:0;c<f;c++)if(c in b&&b[c]===a)return c}return-1},typeToString:function(a){return Object.prototype.toString.call(a)},trim:function(a){return null==a?"":(a+"").replace(G,"")},isWindow:function(a){return null!=a&&typeof("undefined"!=a.window)&&a==a.window},isEmptyObject:function(a){var b=0,c;for(c in a)if(b++,
0<b)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==typeof a||a.nodeType||this.isWindow(a))return!1;var c=Object.prototype.hasOwnProperty;try{if(a.constructor&&!c.call(a,"constructor")&&!c.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(f){return!1}for(b in a);return void 0===b||c.call(a,b)},isArray:function(a){return"[object Array]"==this.typeToString(a)},isString:function(a){return"[object String]"==this.typeToString(a)},isDefined:function(a){return"undefined"!=
typeof a},extend:function(){var a,b,c,f,g,e=arguments[0]||{},p=1,h=arguments.length,k=!1;"boolean"===typeof e&&(k=e,e=arguments[p]||{},p++);"object"===typeof e||d.isFunction(e)||(e={});p===h&&(e=this,p--);for(;p<h;p++)if(null!=(g=arguments[p]))for(f in g)a=e[f],c=g[f],e!==c&&(k&&c&&(d.isPlainObject(c)||(b=d.isArray(c)))?(b?(b=!1,a=a&&d.isArray(a)?a:[]):a=a&&d.isPlainObject(a)?a:{},e[f]=d.extend(k,a,c)):void 0!==c&&(e[f]=c));return e},each:function(a,b){var c,f=0;if(d.isArray(a))for(c=a.length;f<c&&
!1!==b.call(a[f],f,a[f]);f++);else for(f in a)if(!1===b.call(a[f],f,a[f]))break;return a}};d.each("Arguments Function Number Date RegExp Error Object Boolean".split(" "),function(a,b){d["is"+b]=function(a){return d.typeToString(a)==="[object "+b+"]"}});var m={extend:function(){d.extend.apply(this,arguments)},split_name:function(a,b){b=b?b:" ";a=d.trim(a.replace(/\s+/g," "));b=a.split(b);a=b[0];return[a,1<b.length?b[1]:a]},convert_join_type:function(a){return-1!=d.inArray(String(a).toLocaleLowerCase(),
C,0)?a:C[2]},convert_reverse:function(a){return"desc"==String(a).toLocaleLowerCase()||1==a||1==a?1:0},convert_boolean:function(a){a=-1!=d.inArray(a,["and","or"],0)?F[a]:a;return d.isString(a)&&-1<d.inArray(a,v,0)?a:v[0]},convert_operator:function(a){return d.isString(a)&&-1<d.inArray(a,q,0)?a:q[0]},convert_columns:function(a,b){var c=[];b=0<b.length?b:["*"];var f=0,g;for(g in b){var e=b[g];if(d.isString(e))if(e=d.trim(e),/^\s*\*\s*$/gi.test(e)){f++;for(var p in a)c.push({field:p,alias:""})}else e=
e.replace(/^\s+(as)\s+$/i," as ").split(" as "),c.push({field:e[0],alias:e[1]?e[1]:""});else if(d.isObject(e))for(p in e)c.push({field:p,alias:d.isString(e[p])?e[p]:""})}return c},join:function(a,b,c,f,g,e){var p=[],h=c[0],k=this.groups(c,f);d.each(a,function(a,c){a=c[b];d.isDefined(k[a])?d.each(k[a],function(a,b){d.isFunction(e)&&p.push(d.extend({},e.apply(d,[c,b,!0])))}):-1!=d.inArray(g,["left","right"],0)&&d.isFunction(e)&&p.push(d.extend({},e.apply(d,[c,h,!1])))});return p},groups:function(a,
b,c){var f={};d.each(a,function(a,e){a=e[b];d.isDefined(a)&&(d.isDefined(f[a])||(d.isFunction(c)&&c.call(e,a),f[a]=[]),f[a].push(e))});return f},filter:function(a,b){var c=[];if(0<a.length&&d.isFunction(b))d.each(a,function(a,g){a=b.call(g,g,a);0==a||d.isEmptyObject(a)||c.push(a)});else return a;return c},order_by:function(a,b,c,f){c=0<c?c:0;var g=this,e=[];if(0<b.length&&c<b.length){var k=b[c],h=k.rudder,l=[],n=g.groups(a,k.field,function(a){l.push(a)});if(0<l.length){var m=!1;d.isObject(h)?d.isDefined(h.reverse)&&
(m=g.convert_reverse(h.reverse)):m=g.convert_reverse(h);l=d.isDefined(h.fx)?l.sort(function(a,b){a=parseFloat(h.fx.call(D,n[a]));b=parseFloat(h.fx.call(D,n[b]));return(a<b?-1:1)*[1,-1][+!!m]}):l.sort(function(a,b){return E(a,b)*[1,-1][+!!m]});d.each(l,function(a,h){a=n[h];a=g.order_by(a,b,c+1,f);d.each(a,function(a,b){e.push(b)})})}else return g.order_by(a,b,c+1,f)}else d.each(a,function(a,b){d.isFunction(f)?e.push(f.call(b,b,a)):e.push(b)});return e},get_row_data:function(a,b){var c={};d.each(b,
function(b,g){b=g.field;d.isDefined(a[b])&&(c[""==g.alias?g.field:g.alias]=a[b])});return c}},l=function(a){return new l.fn.table(a)};l.fn=l.prototype={model:"1.0.2",constructor:l,extend:function(){return d.extend.apply(this,arguments)},table:function(a){this.clear();k=a;B=(new Date).getTime();return this},debug:function(a){A=a;return this}};l.fn.extend({clear:function(){h={where:new w("&&"),fields:[],limit:[],order_by:[]};return this},fields:function(a){var b=this;d.isString(a)||d.isObject(a)?h.fields.push(a):
d.isArray(a)&&d.each(a,function(a,d){b.fields(d)});return this},join:function(a,b,c,d){d=m.convert_join_type(d);c=m.split_name(c,".");var f=c[0];c=c[1];var e=function(a,b,c){var d={},e;for(e in a)d[e]=a[e];for(var g in b)d[f+"."+g]=1==c?b[g]:null;return d};k="right"==d||"inner"==d&&k.length>b.length?m.join(b,c,k,a,d,e):m.join(k,a,b,c,d,e);t("end of join,data.length:",k.length);return this},order_by:function(a,b){var c=this;d.isArray(a)?d.each(a,function(a,d){c.order_by(d,b)}):d.isObject(a)?d.each(a,
function(a,b){c.order_by(a,b)}):d.isString(a)&&h.order_by.push({field:a,rudder:b});return this},where:function(a,b,c,d){h.where.where(a,b,c,d);return this},where_in:function(a,b,c){d.isString(a)&&this.where(function(){if(d.isArray(b))for(var c in b)this.where(a,q[0],b[c],x[0])},c);return this},where_not_in:function(a,b,c){d.isString(a)&&this.where(function(){if(d.isArray(b))for(var c in b)this.where(a,"!=",b[c],v[0])},c);return this},where_between:function(a,b,c){d.isArray(b)&&1<b.length&&this.where(function(){this.where(a,
">",Math.min(b[0],b[1]),c);this.where(a,"<",Math.max(b[0],b[1]),c)},c);return this},where_like:function(a,b,c){this.where(a,"like",b,c);return this},limit:function(a,b){1==arguments.length?h.limit=[0,Math.max(0,a)]:1<arguments.length&&(h.limit=[Math.max(0,a),Math.max(0,a+b)]);return this},get:function(){var a=k,b=m.convert_columns(k[0],h.fields);0<h.where.conditions.length&&(a=m.filter(a,function(a){return h.where.isMatch(a)?a:!1}));a=0<h.order_by.length?m.order_by(a,h.order_by,0,function(a){return m.get_row_data(a,
b)}):m.filter(a,function(a){return m.get_row_data(a,b)});0<h.limit.length&&(a=a.slice(h.limit[0],Math.min(h.limit[1],a.length)));t("List--",a);t("SQL--",this.getSql());this.clear();return a},find:function(a){a=this.where(a).get();return 0<a.length?a[0]:!1},remove:function(){this.where.apply(this,arguments);var a=0;if(0<h.where.conditions.length){var b=m.filter(k,function(b,d){return h.where.isMatch(b)?(a++,!1):b});k.length=0;d.each(b,function(a){k.push(this)})}else a=k.length,k.length=0;return a},
update:function(a){if(!d.isObject(a))return 0;var b=0;0<h.where.conditions.length?d.each(k,function(c,d){if(h.where.isMatch(d)){b++;for(var f in a)k[c][f]=a[f]}}):d.each(k,function(c){b++;for(var d in a)k[c][d]=a[d]});return b},fetch:function(a){var b=this.get();return d.isFunction(a)?(t("fetch begin"),d.each(b,a),t("fetch end"),this):b},select:function(a,b){return this.fields(a).where(b).get()},count:function(){return this.get().length},getSql:function(){return h.where.queryString()}});l.fn.table.prototype=
l.fn;l.fn.size=function(){return this.length};"function"===typeof define&&define.amd&&define("model",[],function(){return l});var I=n.Model,J=n.M;l.noConflict=function(a){n.M===l&&(n.M=J);a&&n.Model===l&&(n.Model=I);return l};r||(n.Model=n.M=l);return l});
