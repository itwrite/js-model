(function(l,q){"object"===typeof module&&"object"===typeof module.exports?module.exports=l.document?q(l,!0):function(l){if(!l.document)throw Error("Model requires a window with a document");return q(l)}:q(l)})("undefined"!==typeof window?window:this,function(l,q){function B(a,b){if("string"==typeof a&&"string"==typeof b)return a.localeCompare(b);if("number"==typeof a&&"string"==typeof b)return-1;if("string"==typeof a&&"number"==typeof b)return 1;if("number"==typeof a&&"number"==typeof b){if(a>b)return 1;
if(a==b)return 0;if(a<b)return-1}return 0}function v(a,b,d,f){var c,e;Object.defineProperty(this,"boolean",{get:function(){return e},set:function(a){e=m.convert_boolean(a)}});Object.defineProperty(this,"operator",{get:function(){return c},set:function(a){c=m.convert_operator(a)}});this.field=a;this.value=d;this.boolean=f;this.operator=b}function r(a){var b,d=[];Object.defineProperty(this,"boolean",{get:function(){return b},set:function(a){b=m.convert_boolean(a)}});this.boolean=a;this.getConditionArr=
function(){return d};this.where=function(a,b,e,h){if(c.isObject(a))for(var f in a)this.where(f,"==",a[f],b);else if(c.isArray(a))for(var g in a)c.isDefined(a[g].field)&&c.isDefined(a[g].value)&&this.where(a[g].field,a[g].operator,a[g].value,a[g]["boolean"]);else c.isString(a)&&0<String(a).length?d.push(new v(a,b,e,h)):c.isFunction(a)&&(b=new r(b),d.push(b),a.call(b));return this};this.queryString=function(a){var b="";c.each(this.getConditionArr(),function(d,f){var e=[];0<parseInt(d)&&(b+=c.inArray(f["boolean"],
t,0)?" OR ":" AND ");f instanceof r?b+="( "+f.queryString(a)+" )":f instanceof v&&(d=f.field,c.isDefined(a[d])?(e.push(c.isNumber(a[d])?"{"+d+"}":"'{"+d+"}'"),e.push(f.operator),e.push(c.isNumber(f.value)?f.value:"'"+("like"==f.operator?"%"+String(f.value)+"%":String(f.value))+"'")):e.push("false"));b+=e.join(" ")});return b};this.isMatch=function(a){var b=!1;c.each(this.getConditionArr(),function(d,f){var e=!1;if(f instanceof r)e=f.isMatch(a);else if(f instanceof v){var g=f.field,h=f.value;if(c.isDefined(a[g]))switch(f.operator){case "=":case "==":e=
a[g]==h;break;case "===":e=a[g]===h;break;case "!=":e=a[g]!=h;break;case "<>":case "!==":e=a[g]!==h;break;case "<":e=a[g]<h;break;case "<=":e=a[g]<=h;break;case ">":e=a[g]>h;break;case ">=":e=a[g]>=h;break;case ">>":e=a[g]>>h;break;case "<<":e=a[g]<<h;break;case "like":e=function(a,b){var d=!1;c.each(b,function(b,c){if(""!==c&&-1<String(a).indexOf(c))return d=!0,!1});return d}(a[g],String(h).replace(C,D).split("%"));break;default:e=!1}}else e=f;0==d&&(b=e);-1!=c.inArray(f["boolean"],t,0)?b=b||e:0<
d&&(b=b&&e)});return b}}var w=!1,x=null,n=[],u="== === < > <= >= <> != << >> like".split(" "),y=["&&","||","|"],E={and:"&&",or:"||"},z=["left","right","inner"],t=["||","|","or"],F=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,C=/\\|'|\r|\n|\u2028|\u2029/g,k=function(a){return new k.fn.init(a)},G={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},D=function(a){return"\\"+G[a]},A={get data(){return n},each:function(){c.each.apply(this,arguments)},sum:function(a,b){var d=0;this.each(b,function(b,
g){c.isDefined(g[a])&&(d+=parseFloat(g[a]))});return d}},H=function(){if(1==w){var a=["echo["+((new Date).getTime()-x)+"]:"],b;for(b in arguments)a.push(arguments[b]);console.log.apply(this,a)}},c={inArray:function(a,b,d){var c;if(b){if([].indexOf)return Array.prototype.indexOf.call(b,a,d);c=b.length;for(d=d?0>d?Math.max(0,c+d):d:0;d<c;d++)if(d in b&&b[d]===a)return d}return-1},typeToString:function(a){return Object.prototype.toString.call(a)},trim:function(a){return null==a?"":(a+"").replace(F,"")},
isWindow:function(a){return null!=a&&a==a.window},isEmptyObject:function(a){var b=0,d;for(d in a)if(b++,0<b)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==typeof a||a.nodeType||this.isWindow(a))return!1;var d=Object.prototype.hasOwnProperty;try{if(a.constructor&&!d.call(a,"constructor")&&!d.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(f){return!1}for(b in a);return void 0===b||d.call(a,b)},isArray:function(a){return"[object Array]"==this.typeToString(a)},isDefined:function(a){return"undefined"!=
typeof a},extend:function(){var a,b,d,f,g,e=arguments[0]||{},h=1,l=arguments.length,k=!1;"boolean"===typeof e&&(k=e,e=arguments[h]||{},h++);"object"===typeof e||c.isFunction(e)||(e={});h===l&&(e=this,h--);for(;h<l;h++)if(null!=(g=arguments[h]))for(f in g)a=e[f],d=g[f],e!==d&&(k&&d&&(c.isPlainObject(d)||(b=c.isArray(d)))?(b?(b=!1,a=a&&c.isArray(a)?a:[]):a=a&&c.isPlainObject(a)?a:{},e[f]=c.extend(k,a,d)):void 0!==d&&(e[f]=d));return e},each:function(a,b){var d,f=0;if(c.isArray(a))for(d=a.length;f<d&&
!1!==b.call(a[f],f,a[f]);f++);else for(f in a)if(!1===b.call(a[f],f,a[f]))break;return a},filter:function(a,b){var d=c.isArray(a)?{}:[];c.each(a,function(a,g){c.isFunction()&&(d[a]=b.call(g,g,a))});return d}};c.each("Arguments Function String Number Date RegExp Error Object Boolean".split(" "),function(a,b){c["is"+b]=function(a){return c.typeToString(a)==="[object "+b+"]"}});var m={extend:function(){c.extend.apply(this,arguments)}};m.extend({split_name:function(a,b){b=b?b:" ";a=c.trim(a.replace(/\s+/g,
" "));b=a.split(b);a=b[0];return[a,1<b.length?b[1]:a]},convert_join_type:function(a){return-1!=c.inArray(String(a).toLocaleLowerCase(),z,0)?a:z[2]},convert_reverse:function(a){return"desc"==String(a).toLocaleLowerCase()||1==a||1==a?1:0},convert_boolean:function(a){a=-1!=c.inArray(a,["and","or"],0)?E[a]:a;return c.isString(a)&&-1<c.inArray(a,y,0)?a:y[0]},convert_operator:function(a){return c.isString(a)&&-1<c.inArray(a,u,0)?a:u[0]},convert_columns:function(a,b){var d=[];b=0<b.length?b:["*"];var f=
0,g;for(g in b){var e=b[g];if(c.isString(e))if(e=c.trim(e),/^\s*\*\s*$/gi.test(e)){f++;for(var h in a)d.push({field:h,alias:""})}else e=e.replace(/^\s+(as)\s+$/i," as ").split(" as "),d.push({field:e[0],alias:e[1]?e[1]:""});else if(c.isObject(e))for(h in e)d.push({field:h,alias:c.isString(e[h])?e[h]:""})}return d},groups:function(a,b,d){var f={},g=[];c.each(a,function(a,h){c.isDefined(h[b])&&(a=h[b],c.isDefined(f[a])||(g.push(a),f[a]=[],c.isFunction(d)&&d.call(h,a)),f[a].push(h))});return f},join:function(a,
b,d,f,g,e){var h=[],k=d[0],l=this.groups(d,f);c.each(a,function(a,d){a=d[b];c.isDefined(l[a])?c.each(l[a],function(a,b){c.isFunction(e)&&h.push(c.extend({},e.apply(c,[d,b,!0])))}):-1!=c.inArray(g,["left","right"],0)&&c.isFunction(e)&&h.push(c.extend({},e.apply(c,[d,k,!1])))});return h},order_by:function(a,b,d,f,g){d=d?d:0;var e=this,h=[];if(0<b.length&&d<b.length){var l=b[d],k=[],m=e.groups(a,l.field,function(a){k.push(a)});if(0<k.length){var p=l.rudder,n=!1;c.isObject(p)?c.isDefined(p.reverse)&&
(n=e.convert_reverse(p.reverse)):n=e.convert_reverse(p);k=c.isDefined(p.fx)?k.sort(function(a,b){a=parseFloat(p.fx.call(A,m[a]));b=parseFloat(p.fx.call(A,m[b]));return(a<b?-1:1)*[1,-1][+!!n]}):k.sort(function(a,b){return B(a,b)*[1,-1][+!!n]});c.each(k,function(a,k){a=e.order_by(m[k],b,d+1,f,g);c.each(a,function(a,b){h.push(b)})})}else return e.order_by(a,b,d+1,f,g)}else c.each(a,function(a,b){if(e.is_match(b,f)){var d={};c.each(g,function(a,e){a=e.field;c.isDefined(b[a])&&(d[""==e.alias?e.field:e.alias]=
b[a])});h.push(d)}});return h},is_match:function(a,b){var d=!0,f=0;c.each(b,function(b,e){e instanceof r&&(d=0==f?e.isMatch(a):-1!=c.inArray(e["boolean"],t,0)?d||e.isMatch(a):d&&e.isMatch(a),f++)});return d}});k.fn=k.prototype={model:"1.0.1",constructor:k,extend:function(){return c.extend.apply(this,arguments)},init:function(a){this.clear();this.table(a);x=(new Date).getTime();return this},debug:function(a){w=a;return this}};k.fn.extend({clear:function(){this.bindings={where:new r("&&"),fields:[],
limit:[],order_by:[]};return this},table:function(a,b){n=a;b=c.trim(b);c.isString(b)&&""!=b&&m.split_name(b," ");return this},fields:function(a){var b=this;c.isString(a)||c.isObject(a)?b.bindings.fields.push(a):c.isArray(a)&&c.each(a,function(a,c){b.fields(c)});return this},join:function(a,b,d,c){c=m.convert_join_type(c);d=m.split_name(d,".");var f=d[0];d=d[1];var e=function(a,b,d){var c={},e;for(e in a)c[e]=a[e];for(var g in b)c[f+"."+g]=1==d?b[g]:null;return c};n="right"==c?m.join(b,d,n,a,c,e):
m.join(n,a,b,d,c,e);H("__data.length",n.length);return this},order_by:function(a,b){var d=this;c.isArray(a)?c.each(a,function(a,c){d.order_by(c,b)}):c.isObject(a)?c.each(a,function(a,b){d.order_by(a,b)}):c.isString(a)&&d.bindings.order_by.push({field:a,rudder:b});return this},where:function(a,b,c,f){this.bindings.where.where(a,b,c,f);return this},where_in:function(a,b,d){c.isString(a)&&this.where(function(){if(c.isArray(b))for(var d in b)this.where(a,u[0],b[d],t[0])},d);return this},where_not_in:function(a,
b,d){c.isString(a)&&this.where(function(){if(c.isArray(b))for(var d in b)this.where(a,"!=",b[d],u[0])},d);return this},where_between:function(a,b){c.isArray(b)&&1<b.length&&this.where(function(){this.where(a,">>",Math.min(b[0],b[1]));this.where(a,"<<",Math.max(b[0],b[1]))});return this},where_like:function(a,b,c){this.where(a,b,"like",c);return this},limit:function(a,b){1==arguments.length?this.bindings.limit=[0,Math.max(0,a)]:1<arguments.length&&(this.bindings.limit=[Math.max(0,a),Math.max(0,a+b)]);
return this},get:function(){var a=m.order_by(n,this.bindings.order_by,0,[this.bindings.where],m.convert_columns(n[0],this.bindings.fields));0<this.bindings.limit.length&&(a=a.slice(this.bindings.limit[0],this.bindings.limit[1]));this.clear();console.log(a);return a},find:function(a){return this.where(a).get()[0]},fetch:function(a){var b=this.get();return c.isFunction(a)?(c.each(b,a),this):b},select:function(a,b){return this.fields(a).where(b).get()},count:function(){return this.get().length},toSql:function(a){var b=
this.bindings.where.queryString(n[0]);return 1==a?(console.log(b),this):b}});k.fn.init.prototype=k.fn;k.fn.size=function(){return this.length};"function"===typeof define&&define.amd&&define("model",[],function(){return k});var I=l.Model,J=l.M;k.noConflict=function(a){l.M===k&&(l.M=J);a&&l.Model===k&&(l.Model=I);return k};q||(l.Model=l.M=k);return k});
