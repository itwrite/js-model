var __debug=!1,__time=(new Date).getTime(),__data=[],__operators="== === < > <= >= <> != << >> like".split(" "),__booleans=["&&","||","|"],__booleans_map={and:"&&",or:"||"},__join_types=["left","right","inner"],__booleans_or_arr=["||","|","or"],__bindings={},version="1.0.2",r_trim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,escaper=/\\|'|\r|\n|\u2028|\u2029/g,Log=function(){if(1==__debug){var a=["echo["+((new Date).getTime()-__time)/1E3+"s]:"],b;for(b in arguments)a.push(arguments[b]);console.log.apply(this,
a)}},escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escapeChar=function(a){return"\\"+escapes[a]},Vendor={get data(){return __data},each:function(){Helper.each.apply(this,arguments)},sum:function(a,b){var c=0;this.each(b,function(b,f){Helper.isDefined(f[a])&&(c+=parseFloat(f[a]))});return c}};
function compareFunc(a,b){if("string"==typeof a&&"string"==typeof b)return a.localeCompare(b);if("number"==typeof a&&"string"==typeof b)return-1;if("string"==typeof a&&"number"==typeof b)return 1;if("number"==typeof a&&"number"==typeof b){if(a>b)return 1;if(a==b)return 0;if(a<b)return-1}return 0}
function ConditionObj(a,b,c,d){var f=__operators[0],e=__booleans[0];Object.defineProperty(this,"boolean",{get:function(){return e},set:function(a){e=Algorithm.convert_boolean(a)}});Object.defineProperty(this,"operator",{get:function(){return f},set:function(a){f=Algorithm.convert_operator(a)}});this.field=a;this.value=c;this.boolean=d;this.operator=b}
function WhereObj(a){var b=this,c,d=[];Object.defineProperty(this,"boolean",{get:function(){return c},set:function(a){c=Algorithm.convert_boolean(a)}});Object.defineProperty(this,"conditions",{get:function(){return d}});this.boolean=a;this.where=function(a,b,c,f){if(Helper.isObject(a)){f=b;for(var e in a)this.where(e,__operators[0],a[e],f)}else Helper.isString(a)&&0<String(a).length?2==arguments.length?d.push(new ConditionObj(a,__operators[0],b)):d.push(new ConditionObj(a,b,c,f)):Helper.isFunction(a)&&
(e=new WhereObj(b),a.call(e),d.push(e));return this};this.queryString=function(){var a=[];Helper.each(b.conditions,function(b,c){0<parseInt(b)&&a.push(-1!=Helper.inArray(c["boolean"],__booleans_or_arr,0)?" OR ":" AND ");c instanceof WhereObj?a.push("("+c.queryString()+")"):c instanceof ConditionObj&&(b=c.field,String(c.value).replace(escaper,escapeChar),a.push("`"+b+"`"),a.push(c.operator),a.push(Helper.isNumber(c.value)?c.value:"'"+("like"==c.operator?"%"+String(c.value)+"%":String(c.value))+"'"))});
return a.join(" ")};var f=function(a,b){if(b instanceof WhereObj)return b.isMatch(a);if(b instanceof ConditionObj){var c=b.field,d=b.value,e=!1;if(Helper.isDefined(a[c]))switch(b.operator){case "=":case "==":e=a[c]==d;break;case "===":e=a[c]===d;break;case "!=":e=a[c]!=d;break;case "<>":case "!==":e=a[c]!==d;break;case "<":case "<<":e=a[c]<d;break;case "<=":e=a[c]<=d;break;case ">":case ">>":e=a[c]>d;break;case ">=":e=a[c]>=d;break;case "like":e=function(a,b){var c=!1;Helper.each(b,function(b,d){if(""!=
d&&-1<String(a).indexOf(d))return c=!0,!1});return c}(a[c],String(d).replace(escaper,escapeChar).split("%"));break;default:e=!1}return e}return Helper.isBoolean(b)?b:!1};this.isMatch=function(a){var b=this.conditions;if(0==b.length)return!0;var c=!1;Helper.each(b,function(b,d){c=0<parseInt(b)?-1!=Helper.inArray(d["boolean"],__booleans_or_arr,0)?c||f(a,d):c&&f(a,d):f(a,d)});return c}}
var Helper={inArray:function(a,b,c){var d;if(b){if([].indexOf)return Array.prototype.indexOf.call(b,a,c);d=b.length;for(c=c?0>c?Math.max(0,d+c):c:0;c<d;c++)if(c in b&&b[c]===a)return c}return-1},typeToString:function(a){return Object.prototype.toString.call(a)},trim:function(a){return null==a?"":(a+"").replace(r_trim,"")},isWindow:function(a){return null!=a&&a==a.window},isEmptyObject:function(a){var b=0,c;for(c in a)if(b++,0<b)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==
typeof a||a.nodeType||this.isWindow(a))return!1;var c=Object.prototype.hasOwnProperty;try{if(a.constructor&&!c.call(a,"constructor")&&!c.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}for(b in a);return void 0===b||c.call(a,b)},isArray:function(a){return"[object Array]"==this.typeToString(a)},isString:function(a){return"[object String]"==this.typeToString(a)},isDefined:function(a){return"undefined"!=typeof a},extend:function(){var a,b,c,d,f,e=arguments[0]||{},g=1,k=arguments.length,
h=!1;"boolean"===typeof e&&(h=e,e=arguments[g]||{},g++);"object"===typeof e||Helper.isFunction(e)||(e={});g===k&&(e=this,g--);for(;g<k;g++)if(null!=(f=arguments[g]))for(d in f)a=e[d],c=f[d],e!==c&&(h&&c&&(Helper.isPlainObject(c)||(b=Helper.isArray(c)))?(b?(b=!1,a=a&&Helper.isArray(a)?a:[]):a=a&&Helper.isPlainObject(a)?a:{},e[d]=Helper.extend(h,a,c)):void 0!==c&&(e[d]=c));return e},each:function(a,b){var c,d=0;if(Helper.isArray(a))for(c=a.length;d<c&&!1!==b.call(a[d],d,a[d]);d++);else for(d in a)if(!1===
b.call(a[d],d,a[d]))break;return a}};Helper.each("Arguments Function Number Date RegExp Error Object Boolean".split(" "),function(a,b){Helper["is"+b]=function(a){return Helper.typeToString(a)==="[object "+b+"]"}});
var Algorithm={extend:function(){Helper.extend.apply(this,arguments)},split_name:function(a,b){b=b?b:" ";a=Helper.trim(a.replace(/\s+/g," "));b=a.split(b);a=b[0];return[a,1<b.length?b[1]:a]},convert_join_type:function(a){return-1!=Helper.inArray(String(a).toLocaleLowerCase(),__join_types,0)?a:__join_types[2]},convert_reverse:function(a){return"desc"==String(a).toLocaleLowerCase()||1==a||1==a?1:0},convert_boolean:function(a){a=-1!=Helper.inArray(a,["and","or"],0)?__booleans_map[a]:a;return Helper.isString(a)&&
-1<Helper.inArray(a,__booleans,0)?a:__booleans[0]},convert_operator:function(a){return Helper.isString(a)&&-1<Helper.inArray(a,__operators,0)?a:__operators[0]},convert_columns:function(a,b){var c=[];b=0<b.length?b:["*"];var d=0,f;for(f in b){var e=b[f];if(Helper.isString(e))if(e=Helper.trim(e),/^\s*\*\s*$/gi.test(e)){d++;for(var g in a)c.push({field:g,alias:""})}else e=e.replace(/^\s+(as)\s+$/i," as ").split(" as "),c.push({field:e[0],alias:e[1]?e[1]:""});else if(Helper.isObject(e))for(g in e)c.push({field:g,
alias:Helper.isString(e[g])?e[g]:""})}return c},join:function(a,b,c,d,f,e){var g=[],k=c[0],h=this.groups(c,d);Helper.each(a,function(a,c){a=c[b];Helper.isDefined(h[a])?Helper.each(h[a],function(a,b){Helper.isFunction(e)&&g.push(Helper.extend({},e.apply(Helper,[c,b,!0])))}):-1!=Helper.inArray(f,["left","right"],0)&&Helper.isFunction(e)&&g.push(Helper.extend({},e.apply(Helper,[c,k,!1])))});return g},groups:function(a,b,c){var d={};Helper.each(a,function(a,e){a=e[b];Helper.isDefined(a)&&(Helper.isDefined(d[a])||
(Helper.isFunction(c)&&c.call(e,a),d[a]=[]),d[a].push(e))});return d},filter:function(a,b){var c=[];if(0<a.length&&Helper.isFunction(b))Helper.each(a,function(a,f){a=b.call(f,f,a);0==a||Helper.isEmptyObject(a)||c.push(a)});else return a;return c},order_by:function(a,b,c,d){c=0<c?c:0;var f=this,e=[];if(0<b.length&&c<b.length){var g=b[c],k=g.rudder,h=[],m=f.groups(a,g.field,function(a){h.push(a)});if(0<h.length){var l=!1;Helper.isObject(k)?Helper.isDefined(k.reverse)&&(l=f.convert_reverse(k.reverse)):
l=f.convert_reverse(k);h=Helper.isDefined(k.fx)?h.sort(function(a,b){a=parseFloat(k.fx.call(Vendor,m[a]));b=parseFloat(k.fx.call(Vendor,m[b]));return(a<b?-1:1)*[1,-1][+!!l]}):h.sort(function(a,b){return compareFunc(a,b)*[1,-1][+!!l]});Helper.each(h,function(a,g){a=m[g];a=f.order_by(a,b,c+1,d);Helper.each(a,function(a,b){e.push(b)})})}else return f.order_by(a,b,c+1,d)}else Helper.each(a,function(a,b){Helper.isFunction(d)?e.push(d.call(b,b,a)):e.push(b)});return e},get_row_data:function(a,b){var c=
{};Helper.each(b,function(b,f){b=f.field;Helper.isDefined(a[b])&&(c[""==f.alias?f.field:f.alias]=a[b])});return c}};function Model(a){return new Model.fn.table(a)}
Model.fn=Model.prototype={table:function(a){this.clear();__data=a;__time=(new Date).getTime();return this},debug:function(a){__debug=a;return this},clear:function(){__bindings={where:new WhereObj("&&"),fields:[],limit:[],order_by:[]};return this},fields:function(a){var b=this;Helper.isString(a)||Helper.isObject(a)?__bindings.fields.push(a):Helper.isArray(a)&&Helper.each(a,function(a,d){b.fields(d)});return this},join:function(a,b,c,d){d=Algorithm.convert_join_type(d);c=Algorithm.split_name(c,".");
var f=c[0];c=c[1];var e=function(a,b,c){var d={},e;for(e in a)d[e]=a[e];for(var g in b)d[f+"."+g]=1==c?b[g]:null;return d};__data="right"==d||"inner"==d&&__data.length>b.length?Algorithm.join(b,c,__data,a,d,e):Algorithm.join(__data,a,b,c,d,e);Log("end of join,data.length:",__data.length);return this},order_by:function(a,b){var c=this;Helper.isArray(a)?Helper.each(a,function(a,f){c.order_by(f,b)}):Helper.isObject(a)?Helper.each(a,function(a,b){c.order_by(a,b)}):Helper.isString(a)&&__bindings.order_by.push({field:a,
rudder:b});return this},where:function(a,b,c,d){__bindings.where.where(a,b,c,d);return this},where_in:function(a,b,c){Helper.isString(a)&&this.where(function(){if(Helper.isArray(b))for(var c in b)this.where(a,__operators[0],b[c],__booleans_or_arr[0])},c);return this},where_not_in:function(a,b,c){Helper.isString(a)&&this.where(function(){if(Helper.isArray(b))for(var c in b)this.where(a,"!=",b[c],__booleans[0])},c);return this},where_between:function(a,b,c){Helper.isArray(b)&&1<b.length&&this.where(function(){this.where(a,
">",Math.min(b[0],b[1]),c);this.where(a,"<",Math.max(b[0],b[1]),c)},c);return this},where_like:function(a,b,c){this.where(a,"like",b,c);return this},limit:function(a,b){1==arguments.length?__bindings.limit=[0,Math.max(0,a)]:1<arguments.length&&(__bindings.limit=[Math.max(0,a),Math.max(0,a+b)]);return this},remove:function(){this.where.apply(this,arguments);var a=0;if(0<__bindings.where.conditions.length){var b=Algorithm.filter(__data,function(b,d){return __bindings.where.isMatch(b)?(a++,!1):b});__data.length=
0;Helper.each(b,function(a){__data.push(this)})}else a=__data.length,__data.length=0;return a},update:function(a){if(!Helper.isObject(a))return 0;var b=0;0<__bindings.where.conditions.length?Helper.each(__data,function(c,d){if(__bindings.where.isMatch(d)){b++;for(var f in a)__data[c][f]=a[f]}}):Helper.each(__data,function(c){b++;for(var d in a)__data[c][d]=a[d]});return b},get:function(){var a=[],b=Algorithm.convert_columns(__data[0],__bindings.fields);0<__bindings.where.conditions.length&&(a=Algorithm.filter(__data,
function(a){return __bindings.where.isMatch(a)?a:!1}));a=0<__bindings.order_by.length?Algorithm.order_by(a,__bindings.order_by,0,function(a){return Algorithm.get_row_data(a,b)}):Algorithm.filter(a,function(a){return Algorithm.get_row_data(a,b)});0<__bindings.limit.length&&(a=a.slice(__bindings.limit[0],Math.min(__bindings.limit[1],a.length)));Log("List--",a);Log("SQL--",this.getSql());this.clear();return a},find:function(a){a=this.where(a).get();return 0<a.length?a[0]:!1},fetch:function(a){var b=
this.get();return Helper.isFunction(a)?(Log("fetch begin"),Helper.each(b,a),Log("fetch end"),this):b},select:function(a,b){return this.fields(a).where(b).get()},count:function(){return this.get().length},getSql:function(){return __bindings.where.queryString()}};Model.fn.table.prototype=Model.fn;Model.fn.size=function(){return this.length};"object"===typeof module&&"object"===typeof module.exports&&(module.exports=Model);
